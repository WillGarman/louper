{
  "name": "louper",
  "type": "registry:ui",
  "title": "Louper",
  "description": "A zoom circle dev tool component. Hold Alt/Option to magnify any part of your page.",
  "dependencies": [],
  "registryDependencies": [],
  "files": [
    {
      "path": "ui/louper.tsx",
      "type": "registry:ui",
      "content": "\"use client\"\n\nimport * as React from \"react\"\n\ninterface LoupeOptions {\n  /** Magnification level. Default: 2 */\n  zoomLevel?: number\n  /** Minimum zoom level when scrolling. Default: 1 */\n  minZoom?: number\n  /** Maximum zoom level when scrolling. Default: 10 */\n  maxZoom?: number\n  /** Zoom sensitivity for scroll/pinch. Default: 0.002 */\n  zoomSensitivity?: number\n  /** Radius of the magnifier circle in pixels. Default: 150 */\n  radius?: number\n  /** Border width in pixels. Default: 3 */\n  borderWidth?: number\n  /** Border color. Default: \"white\" */\n  borderColor?: string\n  /** Key that activates the loupe. Default: \"Alt\" */\n  hotkey?: \"Alt\" | \"Control\" | \"Shift\" | \"Meta\"\n  /** Fade-out duration in ms. Default: 200 */\n  fadeOutDuration?: number\n}\n\ninterface LoupeProps extends LoupeOptions {\n  /**\n   * When provided, controls the loupe externally.\n   * `true` = loupe visible (hotkey disabled), `false` = hidden.\n   * Omit to use hotkey activation (default).\n   */\n  isOpen?: boolean\n}\n\nfunction Louper({\n  isOpen,\n  zoomLevel = 2,\n  minZoom = 1,\n  maxZoom = 10,\n  zoomSensitivity = 0.002,\n  radius = 150,\n  borderWidth = 3,\n  borderColor = \"white\",\n  hotkey = \"Alt\",\n  fadeOutDuration = 200,\n}: LoupeProps) {\n  const hostRef = React.useRef<HTMLDivElement>(null)\n  const shadowRef = React.useRef<ShadowRoot | null>(null)\n  const wrapperRef = React.useRef<HTMLDivElement | null>(null)\n  const cloneContainerRef = React.useRef<HTMLDivElement | null>(null)\n  const stateRef = React.useRef({\n    active: false,\n    mouseX: 0,\n    mouseY: 0,\n    scrollX: 0,\n    scrollY: 0,\n  })\n  const currentZoomRef = React.useRef(zoomLevel)\n  const rafRef = React.useRef<number | null>(null)\n  const pendingRef = React.useRef(false)\n\n  const controlled = isOpen !== undefined\n  const diameter = radius * 2\n\n  // Initialize shadow DOM once\n  React.useEffect(() => {\n    const host = hostRef.current\n    if (!host || shadowRef.current) return\n\n    const root = host.attachShadow({ mode: \"closed\" })\n    shadowRef.current = root\n\n    const wrapper = document.createElement(\"div\")\n    wrapper.className = \"louper-clone-wrapper\"\n    wrapperRef.current = wrapper\n\n    const cloneContainer = document.createElement(\"div\")\n    cloneContainer.className = \"louper-clone-container\"\n    cloneContainerRef.current = cloneContainer\n\n    wrapper.appendChild(cloneContainer)\n    root.appendChild(wrapper)\n\n    return () => {\n      if (rafRef.current !== null) cancelAnimationFrame(rafRef.current)\n    }\n  }, [])\n\n  // Update shadow styles when options change\n  React.useEffect(() => {\n    const root = shadowRef.current\n    if (!root) return\n\n    let styleEl = root.querySelector(\"style[data-louper]\") as HTMLStyleElement\n    if (!styleEl) {\n      styleEl = document.createElement(\"style\")\n      styleEl.setAttribute(\"data-louper\", \"\")\n      root.insertBefore(styleEl, root.firstChild)\n    }\n\n    styleEl.textContent = `\n      .louper-clone-wrapper {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        overflow: hidden;\n        border-radius: 50%;\n      }\n      .louper-clone-container {\n        position: absolute;\n        top: 0;\n        left: 0;\n        transform-origin: 0 0;\n        will-change: transform;\n      }\n    `\n  }, [radius, borderWidth, borderColor, zoomLevel, fadeOutDuration])\n\n  // Clone document into shadow DOM\n  const cloneDocument = React.useCallback(() => {\n    const root = shadowRef.current\n    const cloneContainer = cloneContainerRef.current\n    if (!root || !cloneContainer) return\n\n    const docEl = document.documentElement\n    const clone = docEl.cloneNode(true) as HTMLElement\n\n    clone.querySelectorAll(\"script\").forEach((s) => s.remove())\n    clone.querySelectorAll(\"[data-louper-host]\").forEach((el) => el.remove())\n\n    // Copy stylesheets\n    root.querySelectorAll(\"[data-louper-sheet]\").forEach((el) => el.remove())\n    for (const sheet of Array.from(document.styleSheets)) {\n      try {\n        if (sheet.href) {\n          const link = document.createElement(\"link\")\n          link.rel = \"stylesheet\"\n          link.href = sheet.href\n          link.setAttribute(\"data-louper-sheet\", \"\")\n          root.appendChild(link)\n        } else if (sheet.ownerNode instanceof HTMLStyleElement) {\n          const style = document.createElement(\"style\")\n          style.textContent = sheet.ownerNode.textContent\n          style.setAttribute(\"data-louper-sheet\", \"\")\n          root.appendChild(style)\n        }\n      } catch {\n        // Cross-origin stylesheet\n      }\n    }\n\n    // Copy canvas data\n    const srcCanvases = docEl.querySelectorAll(\"canvas\")\n    const cloneCanvases = clone.querySelectorAll(\"canvas\")\n    srcCanvases.forEach((src, i) => {\n      const dest = cloneCanvases[i]\n      if (!dest) return\n      dest.width = src.width\n      dest.height = src.height\n      const ctx = dest.getContext(\"2d\")\n      if (ctx) {\n        try {\n          ctx.drawImage(src, 0, 0)\n        } catch {\n          // Tainted canvas\n        }\n      }\n    })\n\n    clone.style.margin = \"0\"\n    clone.style.position = \"absolute\"\n    clone.style.top = \"0\"\n    clone.style.left = \"0\"\n    clone.style.width = docEl.scrollWidth + \"px\"\n    clone.style.height = docEl.scrollHeight + \"px\"\n\n    cloneContainer.innerHTML = \"\"\n    cloneContainer.appendChild(clone)\n  }, [])\n\n  // Render position\n  const scheduleRender = React.useCallback(() => {\n    if (pendingRef.current) return\n    pendingRef.current = true\n    rafRef.current = requestAnimationFrame(() => {\n      pendingRef.current = false\n      rafRef.current = null\n\n      const host = hostRef.current\n      const cloneContainer = cloneContainerRef.current\n      if (!host || !cloneContainer) return\n\n      const { mouseX, mouseY, scrollX, scrollY } = stateRef.current\n      const zoom = currentZoomRef.current\n\n      const hostX = mouseX - radius - borderWidth\n      const hostY = mouseY - radius - borderWidth\n      host.style.transform = `translate(${hostX}px, ${hostY}px)`\n\n      const docX = mouseX + scrollX\n      const docY = mouseY + scrollY\n      const cloneX = radius - docX * zoom\n      const cloneY = radius - docY * zoom\n      cloneContainer.style.transform = `scale(${zoom}) translate(${cloneX / zoom}px, ${cloneY / zoom}px)`\n    })\n  }, [radius, borderWidth])\n\n  // Activate / deactivate\n  const activate = React.useCallback(() => {\n    stateRef.current.active = true\n    stateRef.current.scrollX = window.scrollX\n    stateRef.current.scrollY = window.scrollY\n    currentZoomRef.current = zoomLevel\n    cloneDocument()\n    hostRef.current?.classList.add(\"louper-active\")\n    scheduleRender()\n  }, [cloneDocument, scheduleRender, zoomLevel])\n\n  const deactivate = React.useCallback(() => {\n    stateRef.current.active = false\n    hostRef.current?.classList.remove(\"louper-active\")\n    setTimeout(() => {\n      if (!stateRef.current.active && cloneContainerRef.current) {\n        cloneContainerRef.current.innerHTML = \"\"\n      }\n    }, fadeOutDuration)\n  }, [fadeOutDuration])\n\n  // Controlled mode\n  React.useEffect(() => {\n    if (!controlled) return\n    if (isOpen) {\n      activate()\n    } else {\n      deactivate()\n    }\n  }, [isOpen, controlled, activate, deactivate])\n\n  // Event listeners (hotkey mode)\n  React.useEffect(() => {\n    if (controlled) return\n\n    const onKeyDown = (e: KeyboardEvent) => {\n      if (e.key === hotkey && !stateRef.current.active) {\n        activate()\n      }\n    }\n    const onKeyUp = (e: KeyboardEvent) => {\n      if (e.key === hotkey && stateRef.current.active) {\n        deactivate()\n      }\n    }\n    const onBlur = () => {\n      if (stateRef.current.active) deactivate()\n    }\n\n    window.addEventListener(\"keydown\", onKeyDown)\n    window.addEventListener(\"keyup\", onKeyUp)\n    window.addEventListener(\"blur\", onBlur)\n    return () => {\n      window.removeEventListener(\"keydown\", onKeyDown)\n      window.removeEventListener(\"keyup\", onKeyUp)\n      window.removeEventListener(\"blur\", onBlur)\n    }\n  }, [controlled, hotkey, activate, deactivate])\n\n  // Mouse + scroll + wheel tracking (always active)\n  React.useEffect(() => {\n    const onMouseMove = (e: MouseEvent) => {\n      stateRef.current.mouseX = e.clientX\n      stateRef.current.mouseY = e.clientY\n      if (stateRef.current.active) scheduleRender()\n    }\n    const onScroll = () => {\n      if (stateRef.current.active) {\n        stateRef.current.scrollX = window.scrollX\n        stateRef.current.scrollY = window.scrollY\n        scheduleRender()\n      }\n    }\n    const onWheel = (e: WheelEvent) => {\n      if (stateRef.current.active) {\n        e.preventDefault()\n        const current = currentZoomRef.current\n        currentZoomRef.current = Math.min(\n          maxZoom,\n          Math.max(minZoom, current * (1 - e.deltaY * zoomSensitivity)),\n        )\n        scheduleRender()\n      }\n    }\n\n    window.addEventListener(\"mousemove\", onMouseMove)\n    window.addEventListener(\"scroll\", onScroll, { passive: true })\n    window.addEventListener(\"wheel\", onWheel, { passive: false })\n    return () => {\n      window.removeEventListener(\"mousemove\", onMouseMove)\n      window.removeEventListener(\"scroll\", onScroll)\n      window.removeEventListener(\"wheel\", onWheel)\n    }\n  }, [scheduleRender, minZoom, maxZoom, zoomSensitivity])\n\n  return (\n    <div\n      ref={hostRef}\n      data-louper-host=\"\"\n      style={{\n        position: \"fixed\",\n        top: 0,\n        left: 0,\n        zIndex: 2147483647,\n        pointerEvents: \"none\",\n        width: diameter,\n        height: diameter,\n        borderRadius: \"50%\",\n        border: `${borderWidth}px solid ${borderColor}`,\n        boxShadow: \"0 4px 24px rgba(0,0,0,0.3), 0 0 0 1px rgba(0,0,0,0.1)\",\n        overflow: \"hidden\",\n        opacity: 0,\n        transition: `opacity ${fadeOutDuration}ms ease-out`,\n        willChange: \"transform, opacity\",\n      }}\n    />\n  )\n}\n\n// Add the active styles via a global style tag\nif (typeof document !== \"undefined\") {\n  const id = \"louper-global-styles\"\n  if (!document.getElementById(id)) {\n    const style = document.createElement(\"style\")\n    style.id = id\n    style.textContent = `[data-louper-host].louper-active { opacity: 1 !important; transition: none !important; }`\n    document.head.appendChild(style)\n  }\n}\n\nexport { Louper }\nexport type { LoupeProps, LoupeOptions }\n"
    }
  ]
}
